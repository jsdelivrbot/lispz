<!-- using iframe-panel -->
<specifications>
  <iframe-panel height={ opts.height } heading={ heading }
  menu=specifications-menu owner={ _id } />
  <style>
  </style>
  <script type=text/lispz>
    (var tag this)
    (var owner tag._id)
    (tag.on "mount" (=> (using  [message annotations literate]

      (var open (lambda [packet]
        (var name (last (packet.name.split '/:\s*/')))
        (var heading (+ name " Specifications"))
        
        (var add-documentation (=>
          (var docs (annotations.retrieve "literate" packet.source))
          (return (literate.to-html docs))
        ))
        (var add-specs (=>
          (var specs (annotations.retrieve "spec" packet.source))
          (var specs (specs.map (lambda [spec] (return spec.body))))
          (return (specs.join "\n\n"))
        ))
        
        (var head (+ "<link rel='shortcut icon' type='image/png' href='"
          lispz.path-base "ext/jasmine_favicon.png'>"
          "<script src='" lispz.path-base "lispz.js#jasmine'></" "script>"
          "<script type='text/lispz'>" (add-specs) "</" "script>"))
        (var body "")
        (tag.tags.iframe.open {head body})
      ))

      (message.dispatch (+ "specifications/" opts.name) { open })
      (message.listen (+ owner "-" "specifications") (lambda [packet]
        (open {name: packet.item.title source: packet.item.source})
      ))
    )))
  </script>
</specifications>
