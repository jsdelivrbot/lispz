<panel>
  <!-- <panel [context=default|primary|success|info|warning|danger]
              [heading=heading-text] [footer=footer-text]
              [menu=menu-id]>
       panel-body-content-html
       </panel>
    -->
  <div class="panel { context }">
    <div class=panel-heading if={ opts.heading } name=heading
         ><bars-menu align=right name={ opts.menu }
           owner={ opts.owner }/>
         <h3 class=panel-title>{ opts.heading }</h3></div>
    <div class="panel-body" name=body><yield/></div>
    <div class=panel-footer if={ opts.footer } name=footer
         >{ opts.footer }</div>
  </div>
  
  <script type=text/lispz>
    (@context: (+ "panel-" (or opts.context "default")))
  </script>
</panel>

<bars-menu>
  <div name=dropdown class="dropdown { right: opts.align === 'right' }">
    <a style="text-decoration: none" data-toggle="dropdown"
    class="glyphicon glyphicon-menu-hamburger dropdown-toggle" aria-hidden="true"
    ></a>
    <ul class="dropdown-menu { dropdown-menu-right: opts.align === 'right' }">
      <li each={ items } class={ dropdown-header: header, divider: divider,
          disabled: disabled }><a onclick={ goto } href="#">
          <span class="caret" if={ menu }></span>
          { title || header }
      </a></li>
    </ul>
  </div>
  <style>
    bars-menu > div.right { float: right }
    bars-menu span.caret { margin-left: -11px }
  </style>
  <script type=text/lispz>
    (with "message"
      (message.listen opts.name (=> [items]
        (@root: (@items: items))
        (@update)
      ))
    
      (@on "mount" (=> []
        (($ @dropdown).on "show.bs.dropdown" (=> []
          (@items: @root)
          (@update)
        ))
      ))
      
      (@goto: (=> [ev]
        (cond ev.item.topic (message.send ev.item.topic
          {item: ev.item owner: opts.owner action: "menu"}))
        (cond ev.item.menu (do
          (@items: ev.item.menu)
          (ev.stopPropagation)
        ))
      ))
    )
  </script>
</bars-menu>

<tree>
  <ul class="dropdown-menu { dropdown-menu-right: opts.align === 'right' }">
    <li each={ items } class={ dropdown-header: header, divider: divider,
        disabled: disabled }><a onclick={ goto } href="#">
        <span if={ menu } class="glyphicon glyphicon-{ parent.icon(this) }"
          aria-hidden="true"></span> { title || header }</a>
        <tree-menu if={ menu } >
    </li>
  </ul>
  <style>
    tree ul {
      display: inherit !important;
      position: inherit !important;
    }
    tree span.glyphicon {
      margin-left: -18px;
    }
  </style>
  <script type=text/lispz>
    (with "message"
      (message.listen opts.name (=> [items]
        (@items: items)
        (@update)
      ))
    
      (@goto: (=> [ev]
        (cond ev.item.topic (message.send ev.item.topic
          {item: ev.item owner: opts.owner action: "menu"}))
        (cond ev.item.menu (do
        ))
        (ev.stopPropagation)
      ))
      
      (@icon: (=> [item]
        ## root=element, menu=has menu, etc
        (cond
          (item.root.classList.contains "open") (return "triangle-bottom")
          item.menu                             (return "triangle-right")
          (else)                                (return "")
        )
      ))
    )
  </script>
</tree>

<sidebar>
  <a aria-hidden="true" name=hamburger
    class="glyphicon glyphicon-menu-hamburger"></a>
  <div id=sidebar class="container bg-primary"><yield/></div>
  <style>
    sidebar > a {
      text-decoration: none !important;
      position: absolute !important;
      z-index: 2000;
    }
    #sidebar {
      z-index: 1000;
      position: fixed;
      width: 0;
      height: 100%;
      overflow-y: auto;
      -webkit-transition: all 0.5s ease;
      -moz-transition: all 0.5s ease;
      -o-transition: all 0.5s ease;
      transition: all 0.5s ease;
      padding-right: 0;
      overflow: hidden;
    }
    #sidebar.toggled { width: auto; padding-right: 15px; }
  </style>
  <script type=text/lispz>
    (with "message,dom"
      (@hamburger.onclick: (=> []
        (@sidebar.classList.toggle "toggled")
        (delay 300 ## must be after slide action
          (message.send "page-content-wrapper-padding" @sidebar.offsetWidth)
        )
      ))
      (@on "mount" (delay 300
        (message.send "page-content-wrapper-padding" @sidebar.offsetWidth)
      ))
    )
  </script>
</sidebar>

<page-content>
  <div id=page_content_wrapper>
    <div class={ container-fluid: opts.fluid, container: !opts.fluid }>
      <yield/>
    </div>
  </div>
  <style>
    #page_content_wrapper {
      width: 100%;
      position: absolute;
    }
  </style>  
  <script type=text/lispz>
    (with "message"
      (message.listen "page-content-wrapper-padding" (=> [px]
        (@page-content-wrapper.style.paddingLeft: (+ px "px"))
      ))
    )
  </script>
</page-content>

<bootstrap>
  <div id=page-wrapper><yield/></div>
  <style></style>
  <script type=text/lispz>
    (using  "dom,net,jquery,riot,message"
      (var bootswatch-themes [[ "cerulean" "cosmo" "cyborg" "darkly" "flatly"
        "journal" "lumen" "paper" "readable" "sandstone" "simplex" "slate"
        "spacelab" "superhero" "united" "yeti" ]])
      ###
      # https://bootswatch.com
      # Loads a bootswatch theme to make the page look different.
      # If no theme is provided, a random one is selected.
      ###
      (message.listen "change-bootstrap-theme" (=> [theme] (@theme: theme)
        (cond (not (defined? theme))
          (@theme: (get bootswatch-themes (random bootswatch-themes.length)))
        )
        (net.css (+ "https://bootswatch.com/" @theme "/bootstrap.css"))
      ))
      
      ### Load Bootstrap from the CDN and continue normally once all is done ###
      (net.cdnjs-load "twitter-bootstrap" '/\.map$|\.min\.|npm.js$/' (=> []
        (dom.append! "head" (dom.element "meta"
          {name: "viewport" content: "width=device-width, initial-scale=1"}
        ))
      ))
    )
  </script>
</bootstrap>