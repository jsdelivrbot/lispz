<lispz-repl>
  <div id=lispz_repl_div class={ hidden:hidden }>
    <input type=text name=usings autocomplete=on size=20
      placeholder="(package-list (* to reload))">
    <input type=text name=code autocomplete=on size=50
      placeholder="(Lispz code - enter to execute)">
  </div>
  <style>
    lispz-repl {position: absolute; bottom: 0;}
    lispz-repl .hidden {display: none}
  </style>
  <script type=text/lispz>
      (var tag this)
      (var hidden true)
      (var run (=>
        (var source (((tag.usings.value.split ",").map (lambda [pkg]
          (cond (is (first pkg) "*") (do
            (set! pkg (slice pkg 1))
            (delete (get lispz.cache pkg))
            (delete (get lispz.cache (last (pkg.split "/"))))
          ))
          (return pkg)
        )).join ","))
        (cond
          source (set! source (+ "(using \"" source "\" " tag.code.value ")"))
          (else)  (set! source tag.code.value)
        )
        (console.log (lispz.run "lispz-repl" source))
        (tag.code.select)
      ))
      
      (var toggle-show-repl (=>
        (set! hidden (not hidden)) (tag.update)
        (tag.code.focus) (tag.code.select)
      ))

      (document.body.addEventListener "keydown" (lambda [ev] (cond
        (and ev.altKey ev.shiftKey (is ev.keyCode 82)) (toggle-show-repl)
      )))
      (tag.code.addEventListener "keypress"
        (lambda [ev] (cond (is ev.keyCode 13) (run) )))
  </script>
</lispz-repl>
