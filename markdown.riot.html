<markdown>
  <panel height={ opts.height } heading={ heading } menu={ menu } owner={ _id }>
    <div name=wrapper class=wrapper></div>
  </panel>
  <style>
  </style>
  <script type=text/lispz>
    (ref tag (stateful.morph! this))
    (tag.update! {menu: opts.menu heading: opts.heading})
    (tag.on "mount" (lambda [] (using [markdown dom net regex message]
      (ref contents-area tag.tags.panel.body)
      (ref open (lambda [md from]
        (ref from (or from ""))
        (dom.inner-html! contents-area (markdown.compile md))
        ((dom.select contents-area "a").forEach (lambda [link]
          (ref href (link.getAttribute "href"))
          (cond (not (net.external? href)) (do
            (link.addEventListener "click" (lambda [evt]
              (load (+ from href))
              (evt.preventDefault)
            ))
          ))
        ))
      ))
      (ref load (lambda [href]
        (ref loaded (net.http-get href))
        (ref base (regex.substring href '/(.*\/)[^\/]*$/'))
        (when loaded [md] (open md base))
        (catch loaded [err] (debug err))
      ))
      (cond opts.href (load opts.href))

      ### spec: Markdown >> Panel
        Showdown can take markdown text or url and display the
        HTML created - including most Github extensions.

        In the component HTML section, define a showdown panel as follows.
        The href is optional, and the panel will start empty without it.

            &lt;showdown name=manual heading="Manual"
              href="https://cdn.rawgit.com/paulmarrington/lispz/master/README.md"
            /&gt;

        To load a different markdown document from a server, send a message.
        The final part of the address is the name attribute to the showdown
        element above.

            (message.send "showdown/manual" {
              action: "open"  href: "another-url"
            })

        Alternatively, pass the markdown directly in a string with the load
        message.

            (message.send "showdown/manual" {
              action: "load"  markdown: "# Heading\n*This is markdown*"
            })
      ###
      (message.dispatch (+ "showdown/" opts.name) { open load })
    )))
  </script>
</markdown>
